\hypertarget{_switch_8cs_source}{}\doxysection{Switch.\+cs}
\label{_switch_8cs_source}\index{Editor/UniRx/Scripts/Operators/Switch.cs@{Editor/UniRx/Scripts/Operators/Switch.cs}}
\mbox{\hyperlink{_switch_8cs}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00001}00001 \textcolor{keyword}{using }\mbox{\hyperlink{_boolean_notifier_8cs_a81a223a02c34d82b47199f08308847f2}{System}};}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00002}00002 \textcolor{keyword}{using }System.Collections.Generic;}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00003}00003 \textcolor{keyword}{using }System.Linq;}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00004}00004 \textcolor{keyword}{using }System.Text;}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00005}00005 }
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00006}00006 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespace_uni_rx_1_1_operators}{UniRx.Operators}}}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00007}00007 \{}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00008}00008     \textcolor{keyword}{internal} \textcolor{keyword}{class }SwitchObservable<T> : OperatorObservableBase<T>}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00009}00009     \{}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00010}00010         readonly IObservable<IObservable<T>> sources;}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00011}00011 }
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00012}00012         \textcolor{keyword}{public} SwitchObservable(IObservable<IObservable<T>> sources)}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00013}00013             : base(true)}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00014}00014         \{}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00015}00015             this.sources = sources;}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00016}00016         \}}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00017}00017 }
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00018}00018         \textcolor{keyword}{protected} \textcolor{keyword}{override} IDisposable SubscribeCore(IObserver<T> observer, IDisposable cancel)}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00019}00019         \{}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00020}00020             \textcolor{keywordflow}{return} \textcolor{keyword}{new} SwitchObserver(\textcolor{keyword}{this}, observer, cancel).Run();}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00021}00021         \}}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00022}00022 }
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00023}00023         \textcolor{keyword}{class }SwitchObserver : OperatorObserverBase<IObservable<T>, T>}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00024}00024         \{}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00025}00025             readonly SwitchObservable<T> parent;}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00026}00026 }
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00027}00027             readonly \textcolor{keywordtype}{object} gate = \textcolor{keyword}{new} object();}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00028}00028             readonly SerialDisposable innerSubscription = \textcolor{keyword}{new} SerialDisposable();}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00029}00029             \textcolor{keywordtype}{bool} isStopped = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00030}00030             ulong latest = 0UL;}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00031}00031             \textcolor{keywordtype}{bool} hasLatest = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00032}00032 }
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00033}00033             \textcolor{keyword}{public} SwitchObserver(SwitchObservable<T> parent, IObserver<T> observer, IDisposable cancel) : base(observer, cancel)}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00034}00034             \{}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00035}00035                 this.parent = parent;}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00036}00036             \}}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00037}00037 }
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00038}00038             \textcolor{keyword}{public} IDisposable Run()}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00039}00039             \{}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00040}00040                 var subscription = parent.sources.Subscribe(\textcolor{keyword}{this});}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00041}00041                 \textcolor{keywordflow}{return} StableCompositeDisposable.Create(subscription, innerSubscription);}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00042}00042             \}}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00043}00043 }
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00044}00044             \textcolor{keyword}{public} \textcolor{keyword}{override} \textcolor{keywordtype}{void} \mbox{\hyperlink{class_uni_rx_1_1_operators_1_1_operator_observer_base_a400001c0136d7539f7395398c51846c8}{OnNext}}(IObservable<T> value)}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00045}00045             \{}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00046}00046                 var \textcolor{keywordtype}{id} = \textcolor{keywordflow}{default}(ulong);}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00047}00047                 lock (gate)}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00048}00048                 \{}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00049}00049                     \textcolor{keywordtype}{id} = unchecked(++latest);}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00050}00050                     hasLatest = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00051}00051                 \}}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00052}00052 }
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00053}00053                 var d = \textcolor{keyword}{new} SingleAssignmentDisposable();}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00054}00054                 innerSubscription.Disposable = d;}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00055}00055                 d.Disposable = value.Subscribe(\textcolor{keyword}{new} Switch(\textcolor{keyword}{this}, \textcolor{keywordtype}{id}));}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00056}00056             \}}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00057}00057 }
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00058}00058             \textcolor{keyword}{public} \textcolor{keyword}{override} \textcolor{keywordtype}{void} \mbox{\hyperlink{namespace_uni_rx_a22e9e515f5d77e490876bfb7d85cee83a44cdeb54c6f2aebad54611201c26d6f0}{OnError}}(Exception error)}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00059}00059             \{}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00060}00060                 lock (gate)}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00061}00061                 \{}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00062}00062                     \textcolor{keywordflow}{try} \{ observer.OnError(error); \}}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00063}00063                     \textcolor{keywordflow}{finally} \{ \mbox{\hyperlink{class_uni_rx_1_1_operators_1_1_operator_observer_base_a497f517da37764485e866384c6bd5ac2}{Dispose}}(); \}}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00064}00064                 \}}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00065}00065             \}}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00066}00066 }
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00067}00067             \textcolor{keyword}{public} \textcolor{keyword}{override} \textcolor{keywordtype}{void} \mbox{\hyperlink{namespace_uni_rx_a22e9e515f5d77e490876bfb7d85cee83ad3f2303a2d7ea4ac7945de6d166d9c73}{OnCompleted}}()}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00068}00068             \{}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00069}00069                 lock (gate)}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00070}00070                 \{}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00071}00071                     isStopped = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00072}00072                     \textcolor{keywordflow}{if} (!hasLatest)}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00073}00073                     \{}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00074}00074                         \textcolor{keywordflow}{try} \{ observer.OnCompleted(); \}}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00075}00075                         \textcolor{keywordflow}{finally} \{ \mbox{\hyperlink{class_uni_rx_1_1_operators_1_1_operator_observer_base_a497f517da37764485e866384c6bd5ac2}{Dispose}}(); \}}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00076}00076                     \}}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00077}00077                 \}}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00078}00078             \}}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00079}00079 }
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00080}00080             \textcolor{keyword}{class }Switch : IObserver<T>}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00081}00081             \{}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00082}00082                 readonly SwitchObserver parent;}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00083}00083                 readonly ulong id;}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00084}00084 }
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00085}00085                 \textcolor{keyword}{public} Switch(SwitchObserver observer, ulong \textcolor{keywordtype}{id})}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00086}00086                 \{}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00087}00087                     this.parent = observer;}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00088}00088                     this.id = id;}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00089}00089                 \}}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00090}00090 }
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00091}00091                 \textcolor{keyword}{public} \textcolor{keywordtype}{void} \mbox{\hyperlink{interface_uni_rx_1_1_i_observer_a3b2c2949190d53da6a5b7037dbcb3d14}{OnNext}}(T value)}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00092}00092                 \{}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00093}00093                     lock (parent.gate)}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00094}00094                     \{}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00095}00095                         \textcolor{keywordflow}{if} (parent.latest == \textcolor{keywordtype}{id})}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00096}00096                         \{}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00097}00097                             parent.observer.OnNext(value);}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00098}00098                         \}}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00099}00099                     \}}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00100}00100                 \}}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00101}00101 }
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00102}00102                 \textcolor{keyword}{public} \textcolor{keywordtype}{void} \mbox{\hyperlink{namespace_uni_rx_a22e9e515f5d77e490876bfb7d85cee83a44cdeb54c6f2aebad54611201c26d6f0}{OnError}}(Exception error)}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00103}00103                 \{}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00104}00104                     lock (parent.gate)}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00105}00105                     \{}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00106}00106                         \textcolor{keywordflow}{if} (parent.latest == \textcolor{keywordtype}{id})}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00107}00107                         \{}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00108}00108                             parent.observer.OnError(error);}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00109}00109                         \}}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00110}00110                     \}}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00111}00111                 \}}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00112}00112 }
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00113}00113                 \textcolor{keyword}{public} \textcolor{keywordtype}{void} \mbox{\hyperlink{namespace_uni_rx_a22e9e515f5d77e490876bfb7d85cee83ad3f2303a2d7ea4ac7945de6d166d9c73}{OnCompleted}}()}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00114}00114                 \{}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00115}00115                     lock (parent.gate)}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00116}00116                     \{}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00117}00117                         \textcolor{keywordflow}{if} (parent.latest == \textcolor{keywordtype}{id})}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00118}00118                         \{}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00119}00119                             parent.hasLatest = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00120}00120                             \textcolor{keywordflow}{if} (parent.isStopped)}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00121}00121                             \{}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00122}00122                                 parent.observer.OnCompleted();}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00123}00123                             \}}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00124}00124                         \}}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00125}00125                     \}}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00126}00126                 \}}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00127}00127             \}}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00128}00128         \}}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00129}00129     \}}
\DoxyCodeLine{\Hypertarget{_switch_8cs_source_l00130}00130 \}}

\end{DoxyCode}
